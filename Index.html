
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Email Validator - Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use xlsx.js to read and write Excel files directly in the browser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            max-width: 1200px;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center py-10 px-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="container mx-auto">
        <div class="bg-white rounded-3xl shadow-xl p-8 md:p-12 text-center max-w-2xl mx-auto">
            <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-indigo-700 mb-4">
                Real-time Email Validator
            </h1>
            <p class="text-gray-600 mb-8">
                Upload your Excel file to get a clean list of valid and invalid and active and inactive with zero bounce emails.
            </p>

            <!-- File Upload Area -->
            <div id="upload-area" class="border-2 border-dashed border-gray-300 rounded-2xl p-8 mb-6 transition-colors duration-300 hover:border-purple-500 cursor-pointer">
                <input type="file" id="fileInput" class="hidden" accept=".xlsx,.xls">
                <div class="flex flex-col items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p id="upload-text" class="text-lg text-gray-600 font-medium">Drag & drop your Excel file here or <span class="text-purple-600 font-semibold cursor-pointer">click to browse</span></p>
                    <small class="text-gray-500 mt-2">Supported formats: .xlsx, .xls</small>
                </div>
            </div>

            <!-- Validation Button -->
            <button id="validateBtn" class="w-full bg-gradient-to-r from-purple-600 to-indigo-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all duration-300 hover:from-purple-700 hover:to-indigo-800 focus:outline-none focus:ring-4 focus:ring-purple-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                Validate Emails
            </button>

            <!-- Results Section -->
            <div id="results-area" class="mt-8 hidden">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">Validation Progress</h2>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                    <div id="progressFill" class="bg-gradient-to-r from-green-400 to-blue-500 h-2.5 rounded-full" style="width: 0%;"></div>
                </div>
                <p id="progressText" class="text-gray-600 mb-4">Initializing...</p>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gray-50 rounded-xl p-4 shadow-inner">
                        <div id="totalEmails" class="text-2xl font-bold text-gray-800">0</div>
                        <div class="text-sm text-gray-500">Total</div>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-4 shadow-inner">
                        <div id="validEmails" class="text-2xl font-bold text-green-500">0</div>
                        <div class="text-sm text-gray-500">Valid</div>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-4 shadow-inner">
                        <div id="inactiveEmails" class="text-2xl font-bold text-yellow-500">0</div>
                        <div class="text-sm text-gray-500">Inactive</div>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-4 shadow-inner">
                        <div id="invalidEmails" class="text-2xl font-bold text-red-500">0</div>
                        <div class="text-sm text-gray-500">Invalid</div>
                    </div>
                </div>
                
                <button id="downloadBtn" class="hidden w-full bg-green-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all duration-300 hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-300">
                    Download Sorted Results
                </button>
            </div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('upload-area');
        const uploadText = document.getElementById('upload-text');
        const validateBtn = document.getElementById('validateBtn');
        const resultsArea = document.getElementById('results-area');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const totalEmailsEl = document.getElementById('totalEmails');
        const validEmailsEl = document.getElementById('validEmails');
        const inactiveEmailsEl = document.getElementById('inactiveEmails');
        const invalidEmailsEl = document.getElementById('invalidEmails');
        const downloadBtn = document.getElementById('downloadBtn');

        let selectedFile = null;
        let emails = [];
        let validationResults = [];

        // --- Event Listeners for UI interaction ---

        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileUpload);
        validateBtn.addEventListener('click', startValidation);
        downloadBtn.addEventListener('click', downloadResults);
        
        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-purple-500', 'bg-purple-50');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-purple-500', 'bg-purple-50');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-purple-500', 'bg-purple-50');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileUpload({ target: { files: files } });
            }
        });

        function handleFileUpload(event) {
            selectedFile = event.target.files[0];
            if (selectedFile) {
                uploadText.innerHTML = `File selected: <span class="text-purple-600 font-semibold">${selectedFile.name}</span>`;
                validateBtn.disabled = false;
                validateBtn.textContent = 'Validate Emails';
                resultsArea.classList.add('hidden');
                downloadBtn.classList.add('hidden');
            } else {
                uploadText.innerHTML = `Drag & drop your Excel file here or <span class="text-purple-600 font-semibold cursor-pointer">click to browse</span>`;
                validateBtn.disabled = true;
            }
        }

        async function startValidation() {
            if (!selectedFile) return;

            // Reset UI for new validation
            validateBtn.innerHTML = '<span class="loading-spinner"></span> Validating...';
            validateBtn.disabled = true;
            resultsArea.classList.remove('hidden');
            progressText.textContent = 'Reading file...';
            totalEmailsEl.textContent = '0';
            validEmailsEl.textContent = '0';
            inactiveEmailsEl.textContent = '0';
            invalidEmailsEl.textContent = '0';
            progressFill.style.width = '0%';
            downloadBtn.classList.add('hidden');
            validationResults = [];
            
            // Read the Excel file
            const reader = new FileReader();
            reader.onload = async (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                // Assuming the first column contains emails and the first row is a header
                emails = jsonData.slice(1).map(row => row[0]).filter(email => email);
                totalEmailsEl.textContent = emails.length.toLocaleString();

                if (emails.length === 0) {
                    progressText.textContent = 'No emails found in the file.';
                    validateBtn.disabled = false;
                    validateBtn.innerHTML = 'Validate Emails';
                    return;
                }

                // Start processing emails using a batch approach to prevent UI freeze
                const batchSize = 10000;
                let processedCount = 0;
                let validCount = 0;
                let inactiveCount = 0;
                let invalidCount = 0;
                
                const processBatch = () => {
                    const start = processedCount;
                    const end = Math.min(start + batchSize, emails.length);

                    for (let i = start; i < end; i++) {
                        const email = emails[i];
                        const result = simulateValidation(email);
                        validationResults.push({
                            email: email,
                            status: result.status,
                            reason: result.reason
                        });

                        if (result.status === 'Valid') validCount++;
                        else if (result.status === 'Inactive') inactiveCount++;
                        else invalidCount++;
                        processedCount++;
                    }

                    // Update UI after each batch
                    totalEmailsEl.textContent = emails.length.toLocaleString();
                    validEmailsEl.textContent = validCount.toLocaleString();
                    inactiveEmailsEl.textContent = inactiveCount.toLocaleString();
                    invalidEmailsEl.textContent = invalidCount.toLocaleString();
                    const progress = (processedCount / emails.length) * 100;
                    progressFill.style.width = progress + '%';
                    progressText.textContent = `Processing... ${processedCount.toLocaleString()} of ${emails.length.toLocaleString()} emails validated`;

                    // Check if more emails need to be processed
                    if (processedCount < emails.length) {
                        setTimeout(processBatch, 0); // Schedule the next batch
                    } else {
                        // All emails processed, finalize UI and enable download
                        progressText.textContent = 'âœ… Validation complete!';
                        validateBtn.disabled = false;
                        validateBtn.textContent = 'Validate Another File';
                        downloadBtn.classList.remove('hidden');
                    }
                };

                processBatch(); // Start the first batch
            };
            reader.readAsArrayBuffer(selectedFile);
        }

        /**
         * Simulates email validation with deterministic logic.
         * The results will be consistent for the same email every time.
         * For a real-world tool, this would be an API call to a professional validation service.
         */
        function simulateValidation(email) {
            // A real API call would look something like this:
            // const apiKey = 'YOUR_API_KEY';
            // const apiUrl = `https://api.emailvalidatorpro.com/validate?email=${encodeURIComponent(email)}&key=${apiKey}`;
            // try {
            //     const response = await fetch(apiUrl);
            //     const data = await response.json();
            //     // Process data.status, data.reason, etc.
            //     return data;
            // } catch (error) {
            //     console.error("API call failed:", error);
            //     return { status: "Unknown", reason: "API_ERROR" };
            // }

            // Validate basic syntax
            if (!email || typeof email !== 'string' || !email.includes('@') || !email.includes('.')) {
                return { status: 'Invalid', reason: 'Malformed syntax' };
            }
            
            // Check for common bad domains or keywords using a deterministic hash
            const charCodeSum = email.split('').reduce((sum, char) => sum + char.charCodeAt(0), 0);

            if (email.endsWith('.invalid') || email.endsWith('.example')) {
                 return { status: 'Invalid', reason: 'Invalid TLD or domain' };
            }
            if (email.endsWith('.disposable.com')) {
                return { status: 'Invalid', reason: 'Disposable email' };
            }
            if (email.startsWith('info@') || email.startsWith('support@')) {
                return { status: 'Inactive', reason: 'Role-based email' };
            }
            if (email.includes('test')) {
                return { status: 'Invalid', reason: 'Test email' };
            }
            
            // Deterministic logic based on the email string's properties
            if (charCodeSum % 7 === 0) {
                return { status: 'Invalid', reason: 'Unverified' };
            }
            if (email.length % 5 === 0) {
                return { status: 'Inactive', reason: 'Temporary service' };
            }
            
            return { status: 'Valid', reason: 'OK' };
        }

        function downloadResults() {
            // Create a new worksheet from the validation results
            const worksheet = XLSX.utils.json_to_sheet(validationResults);
            
            // Create a new workbook and append the worksheet
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Validation_Results');

            // Trigger the download of the Excel file
            XLSX.writeFile(workbook, 'validation_results.xlsx');
        }
    </script>
</body>
</html>
